\hypertarget{virqmap_8h}{\section{virqmap.\-h \-File \-Reference}
\label{virqmap_8h}\index{virqmap.\-h@{virqmap.\-h}}
}
{\ttfamily \#include $<$arch\-\_\-types.\-h$>$}\*
{\ttfamily \#include $<$hvmm\-\_\-trace.\-h$>$}\*
{\ttfamily \#include $<$gic.\-h$>$}\*
\-Include dependency graph for virqmap.\-h\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virqmap_8h__incl}
\end{center}
\end{figure}
\-This graph shows which files directly or indirectly include this file\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{virqmap_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{\-Data \-Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structvirqmap__entry}{virqmap\-\_\-entry}
\end{DoxyCompactItemize}
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{virqmap_8h_a447d12ae3ae6bae7378717173319d658}{\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D}~0
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structvirqmap__entry}{virqmap\-\_\-entry} $\ast$ \hyperlink{virqmap_8h_a303ca0708bf2514bbd843c4aa2a8a829}{virqmap\-\_\-for\-\_\-pirq} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} pirq)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{virqmap_8h_ae23dfc79ba4183fbf86031da2ce4d51c}{virqmap\-\_\-init} (void)
\item 
\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{virqmap_8h_a12dba040e471900a7b385b9c3a0e4c85}{virqmap\-\_\-pirq} (\hyperlink{hvmm__types_8h_af7e9bd0adfb7d10e7a7a0ee60a5f962c}{vmid\-\_\-t} vmid, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} virq)
\item 
void \hyperlink{virqmap_8h_a17e7cbe76d72e1890ff5a10724d6f19c}{virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler} (\hyperlink{hvmm__types_8h_af7e9bd0adfb7d10e7a7a0ee60a5f962c}{vmid\-\_\-t} vmid, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} istatus, \hyperlink{arch__types_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} word\-\_\-offset)
\end{DoxyCompactItemize}


\subsection{\-Define \-Documentation}
\hypertarget{virqmap_8h_a447d12ae3ae6bae7378717173319d658}{\index{virqmap.\-h@{virqmap.\-h}!\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D@{\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D}}
\index{\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D@{\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D}!virqmap.h@{virqmap.\-h}}
\subsubsection[{\-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-V\-I\-R\-Q\-M\-A\-P\-\_\-\-E\-N\-T\-R\-Y\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D}~0}}\label{virqmap_8h_a447d12ae3ae6bae7378717173319d658}


\-Definition at line 24 of file virqmap.\-h.



\subsection{\-Function \-Documentation}
\hypertarget{virqmap_8h_a303ca0708bf2514bbd843c4aa2a8a829}{\index{virqmap.\-h@{virqmap.\-h}!virqmap\-\_\-for\-\_\-pirq@{virqmap\-\_\-for\-\_\-pirq}}
\index{virqmap\-\_\-for\-\_\-pirq@{virqmap\-\_\-for\-\_\-pirq}!virqmap.h@{virqmap.\-h}}
\subsubsection[{virqmap\-\_\-for\-\_\-pirq}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf virqmap\-\_\-entry}$\ast$ {\bf virqmap\-\_\-for\-\_\-pirq} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{pirq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}read\mbox{]}}}}\label{virqmap_8h_a303ca0708bf2514bbd843c4aa2a8a829}


\-Definition at line 47 of file virqmap.\-c.


\begin{DoxyCode}
{
    const struct virqmap_entry * result = VIRQMAP_ENTRY_NOTFOUND;

    if ( _virqmap[pirq].vmid != VMID_INVALID) {
        result = &_virqmap[pirq];
    }
    return result;
}
\end{DoxyCode}
\hypertarget{virqmap_8h_ae23dfc79ba4183fbf86031da2ce4d51c}{\index{virqmap.\-h@{virqmap.\-h}!virqmap\-\_\-init@{virqmap\-\_\-init}}
\index{virqmap\-\_\-init@{virqmap\-\_\-init}!virqmap.h@{virqmap.\-h}}
\subsubsection[{virqmap\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf virqmap\-\_\-init} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{virqmap_8h_ae23dfc79ba4183fbf86031da2ce4d51c}


\-Definition at line 25 of file virqmap.\-c.


\begin{DoxyCode}
{
    // TODO(wonseok): read file and initialize the mapping.
    HVMM_TRACE_ENTER();
    int i;

    for (i = 0; i < GIC_NUM_MAX_IRQS; i++) {
        _virqmap[i].vmid = VMID_INVALID;
        _virqmap[i].virq = 0;
    }

    // NOTE(wonseok): referenced by
       https://github.com/kesl/khypervisor/wiki/Hardware-Resources-of-Guest-Linux-on-FastModels-RTSM_VE-Cortex-A15x1
    CFG_GUEST0_VIRQMAP(_virqmap);
    CFG_GUEST1_VIRQMAP(_virqmap);

    vgicd_set_callback_changed_istatus(&
      virqmap_vgicd_changed_istatus_callback_handler);

    HVMM_TRACE_EXIT();

    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virqmap_8h_ae23dfc79ba4183fbf86031da2ce4d51c_cgraph}
\end{center}
\end{figure}


\hypertarget{virqmap_8h_a12dba040e471900a7b385b9c3a0e4c85}{\index{virqmap.\-h@{virqmap.\-h}!virqmap\-\_\-pirq@{virqmap\-\_\-pirq}}
\index{virqmap\-\_\-pirq@{virqmap\-\_\-pirq}!virqmap.h@{virqmap.\-h}}
\subsubsection[{virqmap\-\_\-pirq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\-\_\-t} {\bf virqmap\-\_\-pirq} (
\begin{DoxyParamCaption}
\item[{{\bf vmid\-\_\-t}}]{vmid, }
\item[{{\bf uint32\-\_\-t}}]{virq}
\end{DoxyParamCaption}
)}}\label{virqmap_8h_a12dba040e471900a7b385b9c3a0e4c85}


\-Definition at line 57 of file virqmap.\-c.


\begin{DoxyCode}
{
    uint32_t pirq = PIRQ_INVALID;

    /* FIXME: This is ridiculously inefficient to loop up to GIC_NUM_MAX_IRQS 
      */
    int i;
    for (i = 0; i < GIC_NUM_MAX_IRQS; i++) {
        if ( _virqmap[i].vmid == vmid && _virqmap[i].virq == virq ) {
            pirq = i;
            break;
        }
    }
    return pirq;
}
\end{DoxyCode}
\hypertarget{virqmap_8h_a17e7cbe76d72e1890ff5a10724d6f19c}{\index{virqmap.\-h@{virqmap.\-h}!virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler@{virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler}}
\index{virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler@{virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler}!virqmap.h@{virqmap.\-h}}
\subsubsection[{virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf virqmap\-\_\-vgicd\-\_\-changed\-\_\-istatus\-\_\-callback\-\_\-handler} (
\begin{DoxyParamCaption}
\item[{{\bf vmid\-\_\-t}}]{vmid, }
\item[{{\bf uint32\-\_\-t}}]{istatus, }
\item[{{\bf uint8\-\_\-t}}]{word\-\_\-offset}
\end{DoxyParamCaption}
)}}\label{virqmap_8h_a17e7cbe76d72e1890ff5a10724d6f19c}


\-Definition at line 73 of file virqmap.\-c.


\begin{DoxyCode}
{
    uint32_t cstatus;                          // changed bits only
    uint32_t minirq;
    int bit;

    minirq = word_offset * 32;                 /* irq range: 0~31 + word_offset
       * size_of_istatus_in_bits */
    cstatus = old_vgicd_status[vmid][word_offset] ^ istatus;   // find changed
       bits

    while(cstatus) {
        uint32_t virq;
        uint32_t pirq;
        bit = firstbit32(cstatus);

        virq = minirq + bit;
        pirq = virqmap_pirq(vmid, virq);

        if ( pirq != PIRQ_INVALID ) {
            /* changed bit */
            if ( istatus & (1 << bit) ) {
                printh("[%s : %d] enabled irq num is %d\n", __FUNCTION__, 
      __LINE__, bit + minirq);
                gic_test_configure_irq(pirq, GIC_INT_POLARITY_LEVEL, 
      gic_cpumask_current(), GIC_INT_PRIORITY_DEFAULT );
            } else {
                printh("[%s : %d] disabled irq num is %d\n",__FUNCTION__, 
      __LINE__, bit + minirq);
                gic_disable_irq(pirq);
            }
        } else {
            printh( "WARNING: Ignoring virq %d for guest %d has no mapped pirq
      \n", virq, vmid );
        }
        cstatus &= ~(1<< bit);
    }
    old_vgicd_status[vmid][word_offset] = istatus;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virqmap_8h_a17e7cbe76d72e1890ff5a10724d6f19c_cgraph}
\end{center}
\end{figure}


