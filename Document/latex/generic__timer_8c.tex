\hypertarget{generic__timer_8c}{\section{generic\-\_\-timer/generic\-\_\-timer.c \-File \-Reference}
\label{generic__timer_8c}\index{generic\-\_\-timer/generic\-\_\-timer.\-c@{generic\-\_\-timer/generic\-\_\-timer.\-c}}
}
{\ttfamily \#include $<$generic\-\_\-timer.\-h$>$}\*
{\ttfamily \#include $<$hvmm\-\_\-trace.\-h$>$}\*
{\ttfamily \#include \char`\"{}generic\-\_\-timer\-\_\-regs.\-h\char`\"{}}\*
{\ttfamily \#include $<$config/cfg\-\_\-platform.\-h$>$}\*
\-Include dependency graph for generic\-\_\-timer.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{generic__timer_8c__incl}
\end{center}
\end{figure}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{generic__timer_8c_a1ec3de997b7552597b2ba32e6068e069}{\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler} (int irq, void $\ast$\hyperlink{vdev__timer_8c_a514d7f36beee4b3e39da305e12d39d0a}{regs}, void $\ast$pdata)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_abc62af83e49119c8a1e22606340fcc31}{generic\-\_\-timer\-\_\-init} ()
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_a9c827fc2504de623842afa015a0791e2}{generic\-\_\-timer\-\_\-set\-\_\-tval} (\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bc}{generic\-\_\-timer\-\_\-type\-\_\-t} type, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} tval)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_ac31d0e77e798fb55de96b4ff320c1a17}{generic\-\_\-timer\-\_\-enable\-\_\-int} (\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bc}{generic\-\_\-timer\-\_\-type\-\_\-t} type)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_ae4cbbf157ccf4126af25918bfc239918}{generic\-\_\-timer\-\_\-disable\-\_\-int} (\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bc}{generic\-\_\-timer\-\_\-type\-\_\-t} type)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_a7adf47a410958220c1df75a9edbc253c}{generic\-\_\-timer\-\_\-enable\-\_\-irq} (\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bc}{generic\-\_\-timer\-\_\-type\-\_\-t} type)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{generic__timer_8c_a26fcbba99e1dbf1ac9e06b91e3bc3ab6}{generic\-\_\-timer\-\_\-set\-\_\-callback} (\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bc}{generic\-\_\-timer\-\_\-type\-\_\-t} type, \hyperlink{generic__timer_8h_abc1b1dc35e32f7380f3f22624cb3b6e0}{generic\-\_\-timer\-\_\-callback\-\_\-t} callback)
\end{DoxyCompactItemize}
\subsection*{\-Variables}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{generic__timer_8c_a5b94dd32413eab57ab72bb4b759fc703}{\-\_\-timer\-\_\-irqs} \mbox{[}\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bca2a64bfa046f4766b301a15628ab6e764}{\-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}
\item 
static \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{generic__timer_8c_a05bc27c00841323051dcd14eaf0d95c4}{\-\_\-tvals} \mbox{[}\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bca2a64bfa046f4766b301a15628ab6e764}{\-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}
\item 
static \hyperlink{generic__timer_8h_abc1b1dc35e32f7380f3f22624cb3b6e0}{generic\-\_\-timer\-\_\-callback\-\_\-t} \hyperlink{generic__timer_8c_a793f595a9f49f888bb9f6a50fc960e93}{\-\_\-callback} \mbox{[}\hyperlink{generic__timer_8h_a1070f2e7b73c8b78be519eb9dc26e5bca2a64bfa046f4766b301a15628ab6e764}{\-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}
\end{DoxyCompactItemize}


\subsection{\-Function \-Documentation}
\hypertarget{generic__timer_8c_a1ec3de997b7552597b2ba32e6068e069}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler@{\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler}}
\index{\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler@{\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{\-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}static void {\bf \-\_\-generic\-\_\-timer\-\_\-hyp\-\_\-irq\-\_\-handler} (
\begin{DoxyParamCaption}
\item[{int}]{irq, }
\item[{void $\ast$}]{regs, }
\item[{void $\ast$}]{pdata}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{generic__timer_8c_a1ec3de997b7552597b2ba32e6068e069}


\-Definition at line 71 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    _callback[GENERIC_TIMER_HYP](regs);
}
\end{DoxyCode}
\hypertarget{generic__timer_8c_ae4cbbf157ccf4126af25918bfc239918}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-disable\-\_\-int@{generic\-\_\-timer\-\_\-disable\-\_\-int}}
\index{generic\-\_\-timer\-\_\-disable\-\_\-int@{generic\-\_\-timer\-\_\-disable\-\_\-int}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-disable\-\_\-int}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-disable\-\_\-int} (
\begin{DoxyParamCaption}
\item[{{\bf generic\-\_\-timer\-\_\-type\-\_\-t}}]{type}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_ae4cbbf157ccf4126af25918bfc239918}


\-Definition at line 54 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    uint32_t ctrl;
    hvmm_status_t result = HVMM_STATUS_UNSUPPORTED_FEATURE;

    if ( type == GENERIC_TIMER_HYP ) {
        ctrl = generic_timer_reg_read(GENERIC_TIMER_REG_HYP_CTRL);
        ctrl &= ~GENERIC_TIMER_CTRL_ENABLE;
        ctrl |= GENERIC_TIMER_CTRL_IMASK;

        generic_timer_reg_write(GENERIC_TIMER_REG_HYP_CTRL, ctrl);
        result = HVMM_STATUS_SUCCESS;
    }

    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{generic__timer_8c_ae4cbbf157ccf4126af25918bfc239918_cgraph}
\end{center}
\end{figure}


\hypertarget{generic__timer_8c_ac31d0e77e798fb55de96b4ff320c1a17}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-enable\-\_\-int@{generic\-\_\-timer\-\_\-enable\-\_\-int}}
\index{generic\-\_\-timer\-\_\-enable\-\_\-int@{generic\-\_\-timer\-\_\-enable\-\_\-int}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-enable\-\_\-int}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-enable\-\_\-int} (
\begin{DoxyParamCaption}
\item[{{\bf generic\-\_\-timer\-\_\-type\-\_\-t}}]{type}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_ac31d0e77e798fb55de96b4ff320c1a17}


\-Definition at line 37 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    uint32_t ctrl;
    hvmm_status_t result = HVMM_STATUS_UNSUPPORTED_FEATURE;

    if ( type == GENERIC_TIMER_HYP ) {
        ctrl = generic_timer_reg_read(GENERIC_TIMER_REG_HYP_CTRL);
        ctrl |= GENERIC_TIMER_CTRL_ENABLE;      
        ctrl &= ~GENERIC_TIMER_CTRL_IMASK;
    
        generic_timer_reg_write(GENERIC_TIMER_REG_HYP_CTRL, ctrl);
        result = HVMM_STATUS_SUCCESS;
    }

    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{generic__timer_8c_ac31d0e77e798fb55de96b4ff320c1a17_cgraph}
\end{center}
\end{figure}


\hypertarget{generic__timer_8c_a7adf47a410958220c1df75a9edbc253c}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-enable\-\_\-irq@{generic\-\_\-timer\-\_\-enable\-\_\-irq}}
\index{generic\-\_\-timer\-\_\-enable\-\_\-irq@{generic\-\_\-timer\-\_\-enable\-\_\-irq}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-enable\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-enable\-\_\-irq} (
\begin{DoxyParamCaption}
\item[{{\bf generic\-\_\-timer\-\_\-type\-\_\-t}}]{type}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_a7adf47a410958220c1df75a9edbc253c}


\-Definition at line 76 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_UNSUPPORTED_FEATURE;

    if ( type == GENERIC_TIMER_HYP ) {
        uint32_t irq = _timer_irqs[type];

        gic_test_set_irq_handler(irq, &_generic_timer_hyp_irq_handler, 0);

        gic_test_configure_irq(irq,
            GIC_INT_POLARITY_LEVEL, 
            gic_cpumask_current(),
            GIC_INT_PRIORITY_DEFAULT );

        result = HVMM_STATUS_SUCCESS;
    }
    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{generic__timer_8c_a7adf47a410958220c1df75a9edbc253c_cgraph}
\end{center}
\end{figure}


\hypertarget{generic__timer_8c_abc62af83e49119c8a1e22606340fcc31}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-init@{generic\-\_\-timer\-\_\-init}}
\index{generic\-\_\-timer\-\_\-init@{generic\-\_\-timer\-\_\-init}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-init} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_abc62af83e49119c8a1e22606340fcc31}


\-Definition at line 13 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    _timer_irqs[GENERIC_TIMER_HYP] = 26;
    _timer_irqs[GENERIC_TIMER_NSP] = 27;
    _timer_irqs[GENERIC_TIMER_VIR] = 30;

    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}
\hypertarget{generic__timer_8c_a26fcbba99e1dbf1ac9e06b91e3bc3ab6}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-set\-\_\-callback@{generic\-\_\-timer\-\_\-set\-\_\-callback}}
\index{generic\-\_\-timer\-\_\-set\-\_\-callback@{generic\-\_\-timer\-\_\-set\-\_\-callback}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-set\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-set\-\_\-callback} (
\begin{DoxyParamCaption}
\item[{{\bf generic\-\_\-timer\-\_\-type\-\_\-t}}]{type, }
\item[{{\bf generic\-\_\-timer\-\_\-callback\-\_\-t}}]{callback}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_a26fcbba99e1dbf1ac9e06b91e3bc3ab6}


\-Definition at line 95 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    HVMM_TRACE_ENTER();

    _callback[type] = callback;

    HVMM_TRACE_EXIT();
    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}
\hypertarget{generic__timer_8c_a9c827fc2504de623842afa015a0791e2}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!generic\-\_\-timer\-\_\-set\-\_\-tval@{generic\-\_\-timer\-\_\-set\-\_\-tval}}
\index{generic\-\_\-timer\-\_\-set\-\_\-tval@{generic\-\_\-timer\-\_\-set\-\_\-tval}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{generic\-\_\-timer\-\_\-set\-\_\-tval}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf generic\-\_\-timer\-\_\-set\-\_\-tval} (
\begin{DoxyParamCaption}
\item[{{\bf generic\-\_\-timer\-\_\-type\-\_\-t}}]{type, }
\item[{{\bf uint32\-\_\-t}}]{tval}
\end{DoxyParamCaption}
)}}\label{generic__timer_8c_a9c827fc2504de623842afa015a0791e2}


\-Definition at line 23 of file generic\-\_\-timer.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_UNSUPPORTED_FEATURE;

    if ( type == GENERIC_TIMER_HYP) {
        _tvals[type] = tval;
        generic_timer_reg_write(GENERIC_TIMER_REG_HYP_TVAL, tval);
        result = HVMM_STATUS_SUCCESS;
    } else {
    }

    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{generic__timer_8c_a9c827fc2504de623842afa015a0791e2_cgraph}
\end{center}
\end{figure}




\subsection{\-Variable \-Documentation}
\hypertarget{generic__timer_8c_a793f595a9f49f888bb9f6a50fc960e93}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!\-\_\-callback@{\-\_\-callback}}
\index{\-\_\-callback@{\-\_\-callback}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}{\bf generic\-\_\-timer\-\_\-callback\-\_\-t} {\bf \-\_\-callback}\mbox{[}{\bf \-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{generic__timer_8c_a793f595a9f49f888bb9f6a50fc960e93}


\-Definition at line 11 of file generic\-\_\-timer.\-c.

\hypertarget{generic__timer_8c_a5b94dd32413eab57ab72bb4b759fc703}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!\-\_\-timer\-\_\-irqs@{\-\_\-timer\-\_\-irqs}}
\index{\-\_\-timer\-\_\-irqs@{\-\_\-timer\-\_\-irqs}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{\-\_\-timer\-\_\-irqs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\-\_\-t} {\bf \-\_\-timer\-\_\-irqs}\mbox{[}{\bf \-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{generic__timer_8c_a5b94dd32413eab57ab72bb4b759fc703}


\-Definition at line 9 of file generic\-\_\-timer.\-c.

\hypertarget{generic__timer_8c_a05bc27c00841323051dcd14eaf0d95c4}{\index{generic\-\_\-timer.\-c@{generic\-\_\-timer.\-c}!\-\_\-tvals@{\-\_\-tvals}}
\index{\-\_\-tvals@{\-\_\-tvals}!generic_timer.c@{generic\-\_\-timer.\-c}}
\subsubsection[{\-\_\-tvals}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\-\_\-t} {\bf \-\_\-tvals}\mbox{[}{\bf \-G\-E\-N\-E\-R\-I\-C\-\_\-\-T\-I\-M\-E\-R\-\_\-\-N\-U\-M\-\_\-\-T\-Y\-P\-E\-S}\mbox{]}\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{generic__timer_8c_a05bc27c00841323051dcd14eaf0d95c4}


\-Definition at line 10 of file generic\-\_\-timer.\-c.

