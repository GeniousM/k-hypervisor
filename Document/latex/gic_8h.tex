\hypertarget{gic_8h}{\section{include/gic.h \-File \-Reference}
\label{gic_8h}\index{include/gic.\-h@{include/gic.\-h}}
}
{\ttfamily \#include \char`\"{}hvmm\-\_\-types.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}arch\-\_\-types.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}smp.\-h\char`\"{}}\*
\-Include dependency graph for gic.\-h\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{gic_8h__incl}
\end{center}
\end{figure}
\-This graph shows which files directly or indirectly include this file\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gic_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{gic_8h_a1ae8d5cca4dfb10e3503d0acd68ea045}{\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S}~1024
\item 
\#define \hyperlink{gic_8h_a668ceba2082c303778a4ac407c69e1a9}{gic\-\_\-cpumask\-\_\-current}()~(1u $<$$<$ smp\-\_\-processor\-\_\-id())
\item 
\#define \hyperlink{gic_8h_a8fb3dac20dc3fda9134c4c7508bf9bbe}{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T}~0xa0
\end{DoxyCompactItemize}
\subsection*{\-Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef void($\ast$ \hyperlink{gic_8h_a4b1f3150431142b6910f651a1172f446}{gic\-\_\-irq\-\_\-handler\-\_\-t} )(int irq, void $\ast$\hyperlink{vdev__timer_8c_a514d7f36beee4b3e39da305e12d39d0a}{regs}, void $\ast$pdata)
\end{DoxyCompactItemize}
\subsection*{\-Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{gic_8h_a1f4bb652388c46210cea87dfa0d0da83}{gic\-\_\-int\-\_\-polarity\-\_\-t} \{ \hyperlink{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a48dc59df63e73a692037fbacabb1387d}{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L} =  0, 
\hyperlink{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a1b56e47b3895c0050ab8111cc7ffccaf}{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E} =  1
 \}
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{gic_8h_a5560152d03ce529f947787430eff5a8c}{gic\-\_\-interrupt} (int fiq, void $\ast$\hyperlink{vdev__timer_8c_a514d7f36beee4b3e39da305e12d39d0a}{regs})
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_a53e36754e628b6624a760838e37fd9df}{gic\-\_\-enable\-\_\-irq} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} irq)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_ac9a2d7f5ce83d3499113a8566f65fad0}{gic\-\_\-disable\-\_\-irq} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} irq)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_a0913d7e2dc598b3eb2cb09c4a1185cbe}{gic\-\_\-init} (void)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_a7a8d9c8017d6bcc6fc377b52ed6b74c1}{gic\-\_\-deactivate\-\_\-irq} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} irq)
\item 
volatile \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} $\ast$ \hyperlink{gic_8h_a608941cbc8ab5a657834d451f0368a6e}{gic\-\_\-vgic\-\_\-baseaddr} (void)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_acbe5581611f81cd00b58cebeda222edf}{gic\-\_\-test\-\_\-configure\-\_\-irq} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} irq, \hyperlink{gic_8h_a1f4bb652388c46210cea87dfa0d0da83}{gic\-\_\-int\-\_\-polarity\-\_\-t} polarity, \hyperlink{arch__types_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} cpumask, \hyperlink{arch__types_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} priority)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{gic_8h_aaee4d58fadbe09c39f45e8e114a4dd4d}{gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler} (int irq, \hyperlink{gic_8h_a4b1f3150431142b6910f651a1172f446}{gic\-\_\-irq\-\_\-handler\-\_\-t} handler, void $\ast$pdata)
\end{DoxyCompactItemize}


\subsection{\-Define \-Documentation}
\hypertarget{gic_8h_a668ceba2082c303778a4ac407c69e1a9}{\index{gic.\-h@{gic.\-h}!gic\-\_\-cpumask\-\_\-current@{gic\-\_\-cpumask\-\_\-current}}
\index{gic\-\_\-cpumask\-\_\-current@{gic\-\_\-cpumask\-\_\-current}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-cpumask\-\_\-current}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf gic\-\_\-cpumask\-\_\-current}(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~(1u $<$$<$ smp\-\_\-processor\-\_\-id())}}\label{gic_8h_a668ceba2082c303778a4ac407c69e1a9}


\-Definition at line 9 of file gic.\-h.

\hypertarget{gic_8h_a8fb3dac20dc3fda9134c4c7508bf9bbe}{\index{gic.\-h@{gic.\-h}!\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T}}
\index{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T}!gic.h@{gic.\-h}}
\subsubsection[{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-R\-I\-T\-Y\-\_\-\-D\-E\-F\-A\-U\-L\-T}~0xa0}}\label{gic_8h_a8fb3dac20dc3fda9134c4c7508bf9bbe}


\-Definition at line 10 of file gic.\-h.

\hypertarget{gic_8h_a1ae8d5cca4dfb10e3503d0acd68ea045}{\index{gic.\-h@{gic.\-h}!\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S@{\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S}}
\index{\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S@{\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S}!gic.h@{gic.\-h}}
\subsubsection[{\-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-G\-I\-C\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-I\-R\-Q\-S}~1024}}\label{gic_8h_a1ae8d5cca4dfb10e3503d0acd68ea045}


\-Definition at line 8 of file gic.\-h.



\subsection{\-Typedef \-Documentation}
\hypertarget{gic_8h_a4b1f3150431142b6910f651a1172f446}{\index{gic.\-h@{gic.\-h}!gic\-\_\-irq\-\_\-handler\-\_\-t@{gic\-\_\-irq\-\_\-handler\-\_\-t}}
\index{gic\-\_\-irq\-\_\-handler\-\_\-t@{gic\-\_\-irq\-\_\-handler\-\_\-t}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-irq\-\_\-handler\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef void($\ast$ {\bf gic\-\_\-irq\-\_\-handler\-\_\-t})(int irq, void $\ast${\bf regs}, void $\ast$pdata)}}\label{gic_8h_a4b1f3150431142b6910f651a1172f446}


\-Definition at line 17 of file gic.\-h.



\subsection{\-Enumeration \-Type \-Documentation}
\hypertarget{gic_8h_a1f4bb652388c46210cea87dfa0d0da83}{\index{gic.\-h@{gic.\-h}!gic\-\_\-int\-\_\-polarity\-\_\-t@{gic\-\_\-int\-\_\-polarity\-\_\-t}}
\index{gic\-\_\-int\-\_\-polarity\-\_\-t@{gic\-\_\-int\-\_\-polarity\-\_\-t}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-int\-\_\-polarity\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf gic\-\_\-int\-\_\-polarity\-\_\-t}}}\label{gic_8h_a1f4bb652388c46210cea87dfa0d0da83}
\begin{Desc}
\item[\-Enumerator\-: ]\par
\begin{description}
\index{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L}!gic.\-h@{gic.\-h}}\index{gic.\-h@{gic.\-h}!\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L}}\item[{\em 
\hypertarget{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a48dc59df63e73a692037fbacabb1387d}{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-L\-E\-V\-E\-L}\label{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a48dc59df63e73a692037fbacabb1387d}
}]\index{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E}!gic.\-h@{gic.\-h}}\index{gic.\-h@{gic.\-h}!\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E@{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E}}\item[{\em 
\hypertarget{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a1b56e47b3895c0050ab8111cc7ffccaf}{\-G\-I\-C\-\_\-\-I\-N\-T\-\_\-\-P\-O\-L\-A\-R\-I\-T\-Y\-\_\-\-E\-D\-G\-E}\label{gic_8h_a1f4bb652388c46210cea87dfa0d0da83a1b56e47b3895c0050ab8111cc7ffccaf}
}]\end{description}
\end{Desc}



\-Definition at line 12 of file gic.\-h.


\begin{DoxyCode}
             {
    GIC_INT_POLARITY_LEVEL = 0,
    GIC_INT_POLARITY_EDGE = 1
} gic_int_polarity_t;
\end{DoxyCode}


\subsection{\-Function \-Documentation}
\hypertarget{gic_8h_a7a8d9c8017d6bcc6fc377b52ed6b74c1}{\index{gic.\-h@{gic.\-h}!gic\-\_\-deactivate\-\_\-irq@{gic\-\_\-deactivate\-\_\-irq}}
\index{gic\-\_\-deactivate\-\_\-irq@{gic\-\_\-deactivate\-\_\-irq}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-deactivate\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-deactivate\-\_\-irq} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{irq}
\end{DoxyParamCaption}
)}}\label{gic_8h_a7a8d9c8017d6bcc6fc377b52ed6b74c1}


\-Definition at line 220 of file gic.\-c.


\begin{DoxyCode}
{
    _gic.ba_gicc[GICC_DIR] = irq;
    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}
\hypertarget{gic_8h_ac9a2d7f5ce83d3499113a8566f65fad0}{\index{gic.\-h@{gic.\-h}!gic\-\_\-disable\-\_\-irq@{gic\-\_\-disable\-\_\-irq}}
\index{gic\-\_\-disable\-\_\-irq@{gic\-\_\-disable\-\_\-irq}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-disable\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-disable\-\_\-irq} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{irq}
\end{DoxyParamCaption}
)}}\label{gic_8h_ac9a2d7f5ce83d3499113a8566f65fad0}


\-Definition at line 214 of file gic.\-c.


\begin{DoxyCode}
{
    _gic.ba_gicd[GICD_ICENABLER + irq / 32] = (1u << (irq % 32));
    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}
\hypertarget{gic_8h_a53e36754e628b6624a760838e37fd9df}{\index{gic.\-h@{gic.\-h}!gic\-\_\-enable\-\_\-irq@{gic\-\_\-enable\-\_\-irq}}
\index{gic\-\_\-enable\-\_\-irq@{gic\-\_\-enable\-\_\-irq}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-enable\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-enable\-\_\-irq} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{irq}
\end{DoxyParamCaption}
)}}\label{gic_8h_a53e36754e628b6624a760838e37fd9df}


\-Definition at line 208 of file gic.\-c.


\begin{DoxyCode}
{
    _gic.ba_gicd[GICD_ISENABLER + irq / 32] = (1u << (irq % 32));
    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}
\hypertarget{gic_8h_a0913d7e2dc598b3eb2cb09c4a1185cbe}{\index{gic.\-h@{gic.\-h}!gic\-\_\-init@{gic\-\_\-init}}
\index{gic\-\_\-init@{gic\-\_\-init}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-init} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{gic_8h_a0913d7e2dc598b3eb2cb09c4a1185cbe}


\-Definition at line 247 of file gic.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_UNKNOWN_ERROR;
    int i;

    HVMM_TRACE_ENTER();

    for( i = 0; i < GIC_NUM_MAX_IRQS; i++) {
        _gic.handlers[i] = 0;
    }
    
    /*
     * Determining VA of GIC base adddress has not been defined yet. Let is use
       the PA for the time being
     */
    result = gic_init_baseaddr((void*)CFG_GIC_BASE_PA);

    if ( result == HVMM_STATUS_SUCCESS ) {
        gic_dump_registers();
    }

    /*
     * Initialize and Enable GIC Distributor
     */
    if ( result == HVMM_STATUS_SUCCESS ) {
        result = gic_init_dist();
    }

    /*
     * Initialize and Enable GIC CPU Interface for this CPU
     */
    if ( result == HVMM_STATUS_SUCCESS ) {
        result = gic_init_cpui();
    }
    if ( result == HVMM_STATUS_SUCCESS ) {
        _gic.initialized = GIC_SIGNATURE_INITIALIZED;
    }

    HVMM_TRACE_EXIT();
    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gic_8h_a0913d7e2dc598b3eb2cb09c4a1185cbe_cgraph}
\end{center}
\end{figure}


\hypertarget{gic_8h_a5560152d03ce529f947787430eff5a8c}{\index{gic.\-h@{gic.\-h}!gic\-\_\-interrupt@{gic\-\_\-interrupt}}
\index{gic\-\_\-interrupt@{gic\-\_\-interrupt}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-interrupt}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf gic\-\_\-interrupt} (
\begin{DoxyParamCaption}
\item[{int}]{fiq, }
\item[{void $\ast$}]{regs}
\end{DoxyParamCaption}
)}}\label{gic_8h_a5560152d03ce529f947787430eff5a8c}


\-Definition at line 337 of file gic.\-c.


\begin{DoxyCode}
{
    /*
     * 1. ACK - CPU Interface - GICC_IAR read
     * 2. Completion - CPU Interface - GICC_EOIR
     * 2.1 Deactivation - CPU Interface - GICC_DIR
     */
    uint32_t iar;

    uint32_t irq;
    struct arch_regs *regs = pregs;
    const struct virqmap_entry *virq_entry;

    /* ACK */
    iar = _gic.ba_gicc[GICC_IAR];
    irq = iar & GICC_IAR_INTID_MASK;
    if ( irq < _gic.lines ) {
        virq_entry = virqmap_for_pirq(irq);

        /* ISR */
        printh( "ISR(irq):%x\n", irq);

        /* IRQ INJECTION */
        if(virq_entry != VIRQMAP_ENTRY_NOTFOUND) { 

            /* priority drop only for hanlding irq in guest */
            _gic.ba_gicc[GICC_EOIR] = irq;
            virq_inject(virq_entry->vmid, virq_entry->virq, irq, 1);

        } else {

            if ( _gic.handlers[irq] ) {
                _gic.handlers[irq]( irq, regs, 0 );
            }

            /* Completion & Deactivation */
            _gic.ba_gicc[GICC_EOIR] = irq;
            _gic.ba_gicc[GICC_DIR] = irq;
        }
    } else {
        printh( "gic:no pending irq:%x\n", irq);
    }
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gic_8h_a5560152d03ce529f947787430eff5a8c_cgraph}
\end{center}
\end{figure}


\hypertarget{gic_8h_acbe5581611f81cd00b58cebeda222edf}{\index{gic.\-h@{gic.\-h}!gic\-\_\-test\-\_\-configure\-\_\-irq@{gic\-\_\-test\-\_\-configure\-\_\-irq}}
\index{gic\-\_\-test\-\_\-configure\-\_\-irq@{gic\-\_\-test\-\_\-configure\-\_\-irq}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-test\-\_\-configure\-\_\-irq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-test\-\_\-configure\-\_\-irq} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{irq, }
\item[{{\bf gic\-\_\-int\-\_\-polarity\-\_\-t}}]{polarity, }
\item[{{\bf uint8\-\_\-t}}]{cpumask, }
\item[{{\bf uint8\-\_\-t}}]{priority}
\end{DoxyParamCaption}
)}}\label{gic_8h_acbe5581611f81cd00b58cebeda222edf}


\-Definition at line 294 of file gic.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_UNKNOWN_ERROR;

    HVMM_TRACE_ENTER();
    if ( irq < _gic.lines ) {
        uint32_t icfg;
        volatile uint8_t *reg8;
        /* disable forwarding */
        result = gic_disable_irq( irq );

        if ( result == HVMM_STATUS_SUCCESS ) {

            /* polarity: level or edge */
            icfg = _gic.ba_gicd[GICD_ICFGR + irq / 16];
            if ( polarity == GIC_INT_POLARITY_LEVEL ) {
                icfg &= ~( 2u << (2 * (irq % 16)) );
            } else {
                icfg |= ( 2u << (2 * (irq % 16)) );
            }
            _gic.ba_gicd[GICD_ICFGR + irq / 16] = icfg;

            /* routing */
        
            reg8 = (uint8_t *) &(_gic.ba_gicd[GICD_ITARGETSR]);
            reg8[irq] = cpumask;

            /* priority */
            reg8 = (uint8_t *) &(_gic.ba_gicd[GICD_IPRIORITYR]);
            reg8[irq] = priority;

            /* enable forwarding */
            result = gic_enable_irq( irq );
        }
    } else {
        uart_print( "invalid irq:"); uart_print_hex32(irq); uart_print("\n\r");
        result = HVMM_STATUS_UNSUPPORTED_FEATURE;
    }

    HVMM_TRACE_EXIT();
    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{gic_8h_acbe5581611f81cd00b58cebeda222edf_cgraph}
\end{center}
\end{figure}


\hypertarget{gic_8h_aaee4d58fadbe09c39f45e8e114a4dd4d}{\index{gic.\-h@{gic.\-h}!gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler@{gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler}}
\index{gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler@{gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf gic\-\_\-test\-\_\-set\-\_\-irq\-\_\-handler} (
\begin{DoxyParamCaption}
\item[{int}]{irq, }
\item[{{\bf gic\-\_\-irq\-\_\-handler\-\_\-t}}]{handler, }
\item[{void $\ast$}]{pdata}
\end{DoxyParamCaption}
)}}\label{gic_8h_aaee4d58fadbe09c39f45e8e114a4dd4d}


\-Definition at line 226 of file gic.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_BUSY;
    if ( irq < GIC_NUM_MAX_IRQS ) {
        _gic.handlers[irq] = handler;
        result = HVMM_STATUS_SUCCESS;
    }
    return result;
}
\end{DoxyCode}
\hypertarget{gic_8h_a608941cbc8ab5a657834d451f0368a6e}{\index{gic.\-h@{gic.\-h}!gic\-\_\-vgic\-\_\-baseaddr@{gic\-\_\-vgic\-\_\-baseaddr}}
\index{gic\-\_\-vgic\-\_\-baseaddr@{gic\-\_\-vgic\-\_\-baseaddr}!gic.h@{gic.\-h}}
\subsubsection[{gic\-\_\-vgic\-\_\-baseaddr}]{\setlength{\rightskip}{0pt plus 5cm}volatile {\bf uint32\-\_\-t}$\ast$ {\bf gic\-\_\-vgic\-\_\-baseaddr} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{gic_8h_a608941cbc8ab5a657834d451f0368a6e}


\-Definition at line 236 of file gic.\-c.


\begin{DoxyCode}
{
    if ( _gic.initialized != GIC_SIGNATURE_INITIALIZED ) {
        HVMM_TRACE_ENTER();
        uart_print("gic: ERROR - not initialized\n\r");
        HVMM_TRACE_EXIT();
    }

    return _gic.ba_gich;
}
\end{DoxyCode}
