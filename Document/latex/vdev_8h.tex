\hypertarget{vdev_8h}{\section{include/vdev.h \-File \-Reference}
\label{vdev_8h}\index{include/vdev.\-h@{include/vdev.\-h}}
}
{\ttfamily \#include $<$context.\-h$>$}\*
{\ttfamily \#include $<$hvmm\-\_\-types.\-h$>$}\*
\-Include dependency graph for vdev.\-h\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=323pt]{vdev_8h__incl}
\end{center}
\end{figure}
\-This graph shows which files directly or indirectly include this file\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{vdev_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{\-Data \-Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structvdev__info__t}{vdev\-\_\-info\-\_\-t}
\end{DoxyCompactItemize}
\subsection*{\-Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef \hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t}($\ast$ \hyperlink{vdev_8h_aeaabc2529ee76704e7c51336e1caeec4}{vdev\-\_\-callback\-\_\-t} )(\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} wnr, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} offset, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} $\ast$pvalue, \hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5}{vdev\-\_\-access\-\_\-size\-\_\-t} access\-\_\-size)
\end{DoxyCompactItemize}
\subsection*{\-Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5}{vdev\-\_\-access\-\_\-size\-\_\-t} \{ \hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5af10afe26468f4494ca0b0718d4197648}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E} =  0, 
\hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a526098249e81d0ed94e8da741bc2ed6f}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D} =  1, 
\hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a40d9a5ab79aa3254d4d5c118c76cc59d}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D} =  2, 
\hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a84c3834125bdfa74c08a0e2aa4aa4e4c}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D} =  3
 \}
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{vdev_8h_ae5a6fee7377fe25c30418c102674e153}{vdev\-\_\-init} (void)
\item 
int \hyperlink{vdev_8h_a16fc4b2feb3a578d89984cc85e0c8b75}{register\-\_\-vdev} (void)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{vdev_8h_adef10b9bd7b82e079ca0b60b6a555d09}{vdev\-\_\-reg\-\_\-device} (\hyperlink{structvdev__info__t}{vdev\-\_\-info\-\_\-t} $\ast$new\-\_\-vdev)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{vdev_8h_a1564c6d30e83e68553a0fce874f7d169}{vdev\-\_\-emulate} (\hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} fipa, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} wnr, \hyperlink{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5}{vdev\-\_\-access\-\_\-size\-\_\-t} access\-\_\-size, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} srt, struct \hyperlink{structarch__regs}{arch\-\_\-regs} $\ast$\hyperlink{vdev__timer_8c_a514d7f36beee4b3e39da305e12d39d0a}{regs})
\end{DoxyCompactItemize}


\subsection{\-Typedef \-Documentation}
\hypertarget{vdev_8h_aeaabc2529ee76704e7c51336e1caeec4}{\index{vdev.\-h@{vdev.\-h}!vdev\-\_\-callback\-\_\-t@{vdev\-\_\-callback\-\_\-t}}
\index{vdev\-\_\-callback\-\_\-t@{vdev\-\_\-callback\-\_\-t}!vdev.h@{vdev.\-h}}
\subsubsection[{vdev\-\_\-callback\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf hvmm\-\_\-status\-\_\-t}($\ast$  {\bf vdev\-\_\-callback\-\_\-t})({\bf uint32\-\_\-t} wnr, {\bf uint32\-\_\-t} offset, {\bf uint32\-\_\-t} $\ast$pvalue, {\bf vdev\-\_\-access\-\_\-size\-\_\-t} access\-\_\-size)}}\label{vdev_8h_aeaabc2529ee76704e7c51336e1caeec4}


\-Definition at line 20 of file vdev.\-h.



\subsection{\-Enumeration \-Type \-Documentation}
\hypertarget{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5}{\index{vdev.\-h@{vdev.\-h}!vdev\-\_\-access\-\_\-size\-\_\-t@{vdev\-\_\-access\-\_\-size\-\_\-t}}
\index{vdev\-\_\-access\-\_\-size\-\_\-t@{vdev\-\_\-access\-\_\-size\-\_\-t}!vdev.h@{vdev.\-h}}
\subsubsection[{vdev\-\_\-access\-\_\-size\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf vdev\-\_\-access\-\_\-size\-\_\-t}}}\label{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5}
\begin{Desc}
\item[\-Enumerator\-: ]\par
\begin{description}
\index{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E}!vdev.\-h@{vdev.\-h}}\index{vdev.\-h@{vdev.\-h}!\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E}}\item[{\em 
\hypertarget{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5af10afe26468f4494ca0b0718d4197648}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-B\-Y\-T\-E}\label{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5af10afe26468f4494ca0b0718d4197648}
}]\index{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D}!vdev.\-h@{vdev.\-h}}\index{vdev.\-h@{vdev.\-h}!\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D}}\item[{\em 
\hypertarget{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a526098249e81d0ed94e8da741bc2ed6f}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-H\-W\-O\-R\-D}\label{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a526098249e81d0ed94e8da741bc2ed6f}
}]\index{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D}!vdev.\-h@{vdev.\-h}}\index{vdev.\-h@{vdev.\-h}!\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D}}\item[{\em 
\hypertarget{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a40d9a5ab79aa3254d4d5c118c76cc59d}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-W\-O\-R\-D}\label{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a40d9a5ab79aa3254d4d5c118c76cc59d}
}]\index{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D}!vdev.\-h@{vdev.\-h}}\index{vdev.\-h@{vdev.\-h}!\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D@{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D}}\item[{\em 
\hypertarget{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a84c3834125bdfa74c08a0e2aa4aa4e4c}{\-V\-D\-E\-V\-\_\-\-A\-C\-C\-E\-S\-S\-\_\-\-R\-E\-S\-E\-R\-V\-E\-D}\label{vdev_8h_ad6282c1758c5e6605fbac6d3007ae9d5a84c3834125bdfa74c08a0e2aa4aa4e4c}
}]\end{description}
\end{Desc}



\-Definition at line 7 of file vdev.\-h.


\begin{DoxyCode}
             {
    VDEV_ACCESS_BYTE = 0,
    VDEV_ACCESS_HWORD = 1,
    VDEV_ACCESS_WORD = 2,
    VDEV_ACCESS_RESERVED = 3
} vdev_access_size_t;
\end{DoxyCode}


\subsection{\-Function \-Documentation}
\hypertarget{vdev_8h_a16fc4b2feb3a578d89984cc85e0c8b75}{\index{vdev.\-h@{vdev.\-h}!register\-\_\-vdev@{register\-\_\-vdev}}
\index{register\-\_\-vdev@{register\-\_\-vdev}!vdev.h@{vdev.\-h}}
\subsubsection[{register\-\_\-vdev}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf register\-\_\-vdev} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{vdev_8h_a16fc4b2feb3a578d89984cc85e0c8b75}
\hypertarget{vdev_8h_a1564c6d30e83e68553a0fce874f7d169}{\index{vdev.\-h@{vdev.\-h}!vdev\-\_\-emulate@{vdev\-\_\-emulate}}
\index{vdev\-\_\-emulate@{vdev\-\_\-emulate}!vdev.h@{vdev.\-h}}
\subsubsection[{vdev\-\_\-emulate}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf vdev\-\_\-emulate} (
\begin{DoxyParamCaption}
\item[{{\bf uint32\-\_\-t}}]{fipa, }
\item[{{\bf uint32\-\_\-t}}]{wnr, }
\item[{{\bf vdev\-\_\-access\-\_\-size\-\_\-t}}]{access\-\_\-size, }
\item[{{\bf uint32\-\_\-t}}]{srt, }
\item[{struct {\bf arch\-\_\-regs} $\ast$}]{regs}
\end{DoxyParamCaption}
)}}\label{vdev_8h_a1564c6d30e83e68553a0fce874f7d169}


\-Definition at line 49 of file vdev.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_NOT_FOUND;
    int i = 0;
    uint32_t offset;
    uint8_t isize = 4;

    HVMM_TRACE_ENTER();
    if ( regs->cpsr & 0x20 ) {
        /* Thumb */
        isize = 2;
    }

    for (i = 0; i < MAX_VDEV; i++){
        if ( vdev_list[i].base == 0 ) break;

        offset = fipa - vdev_list[i].base;
        if ( fipa >= vdev_list[i].base && offset < vdev_list[i].size && 
      vdev_list[i].handler != 0) {
            /* fipa is in the rage: base ~ base + size */
            printh("vdev: found %s for fipa %x srt:%x gpr[srt]:%x write:%d
       vmid:%d\n", vdev_list[i].name, fipa, srt, regs->gpr[srt], wnr, context_current_vmid(
      ) );
            result = vdev_list[i].handler(wnr, offset, &(regs->gpr[srt]), 
      access_size);
            if ( wnr == 0 ) {
                printh("vdev: result:%x\n", regs->gpr[srt] );
            }

            /* Update PC regardless handling result */
            regs->pc += isize;
            break;
        } else {
            printh("vdev: fipa %x base %x not matched\n", fipa, vdev_list[i].
      base );
        }
    }
    HVMM_TRACE_EXIT();

    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{vdev_8h_a1564c6d30e83e68553a0fce874f7d169_cgraph}
\end{center}
\end{figure}


\hypertarget{vdev_8h_ae5a6fee7377fe25c30418c102674e153}{\index{vdev.\-h@{vdev.\-h}!vdev\-\_\-init@{vdev\-\_\-init}}
\index{vdev\-\_\-init@{vdev\-\_\-init}!vdev.h@{vdev.\-h}}
\subsubsection[{vdev\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf vdev\-\_\-init} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{vdev_8h_ae5a6fee7377fe25c30418c102674e153}


\-Definition at line 11 of file vdev.\-c.


\begin{DoxyCode}
{
    int i = 0;
    for (i = 0; i < MAX_VDEV; i++) {
        vdev_list[i].name = 0;
        vdev_list[i].base = 0;
        vdev_list[i].size = 0;
        vdev_list[i].handler = 0x0;
    }
}
\end{DoxyCode}
\hypertarget{vdev_8h_adef10b9bd7b82e079ca0b60b6a555d09}{\index{vdev.\-h@{vdev.\-h}!vdev\-\_\-reg\-\_\-device@{vdev\-\_\-reg\-\_\-device}}
\index{vdev\-\_\-reg\-\_\-device@{vdev\-\_\-reg\-\_\-device}!vdev.h@{vdev.\-h}}
\subsubsection[{vdev\-\_\-reg\-\_\-device}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf vdev\-\_\-reg\-\_\-device} (
\begin{DoxyParamCaption}
\item[{{\bf vdev\-\_\-info\-\_\-t} $\ast$}]{new\-\_\-vdev}
\end{DoxyParamCaption}
)}}\label{vdev_8h_adef10b9bd7b82e079ca0b60b6a555d09}


\-Definition at line 22 of file vdev.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_BUSY;
    int i = 0;

    HVMM_TRACE_ENTER();
    for (i = 0; i < MAX_VDEV; i++) {
        if (vdev_list[i].handler == 0x0 ) {
            vdev_list[i].name = new_vdev->name;
            vdev_list[i].base = new_vdev->base;
            vdev_list[i].size = new_vdev->size;
            vdev_list[i].handler = new_vdev->handler;
            printh("vdev:Registered vdev '%s' at index %d\n", vdev_list[i].name
      , i);

            result = HVMM_STATUS_SUCCESS;
            break;
        }
    }

    if ( result != HVMM_STATUS_SUCCESS ) {
        printh("vdev:Failed registering vdev '%s', max %d full \n", new_vdev->
      name, MAX_VDEV);
    }

    HVMM_TRACE_EXIT();
    return result;
}
\end{DoxyCode}
