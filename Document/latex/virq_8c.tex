\hypertarget{virq_8c}{\section{virq.\-c \-File \-Reference}
\label{virq_8c}\index{virq.\-c@{virq.\-c}}
}
{\ttfamily \#include \char`\"{}virq.\-h\char`\"{}}\*
{\ttfamily \#include $<$k-\/hypervisor-\/config.\-h$>$}\*
{\ttfamily \#include $<$hvmm\-\_\-trace.\-h$>$}\*
{\ttfamily \#include $<$vgic.\-h$>$}\*
{\ttfamily \#include $<$gic.\-h$>$}\*
{\ttfamily \#include $<$slotpirq.\-h$>$}\*
{\ttfamily \#include $<$log/print.\-h$>$}\*
\-Include dependency graph for virq.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virq_8c__incl}
\end{center}
\end{figure}
\subsection*{\-Data \-Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structvirq__entry}{virq\-\_\-entry}
\end{DoxyCompactItemize}
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{virq_8c_ae7aecd279ea8dfcea62c7472d3f29fde}{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}~16
\item 
\#define \hyperlink{virq_8c_afbf0d191562f9b6d4977a7e332e4decd}{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S}~1024
\item 
\#define \hyperlink{virq_8c_ad221f8c247cfc9c0662d3df9582084b1}{\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}(pirq)~(pirq $>$= \hyperlink{virq_8c_ae7aecd279ea8dfcea62c7472d3f29fde}{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q} \&\& pirq $<$ \hyperlink{virq_8c_afbf0d191562f9b6d4977a7e332e4decd}{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S})
\item 
\#define \hyperlink{virq_8c_a1d67362b0e88bdcf1949d27e6308aea6}{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}~128
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{virq_8c_a6bd895c43353871b1a0da7c40301215d}{virq\-\_\-inject} (\hyperlink{hvmm__types_8h_af7e9bd0adfb7d10e7a7a0ee60a5f962c}{vmid\-\_\-t} vmid, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} virq, \hyperlink{arch__types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} pirq, \hyperlink{arch__types_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} hw)
\item 
static void \hyperlink{virq_8c_ab76bcaec8e983ed0c8ac21a738b7eb31}{virq\-\_\-flush} (\hyperlink{hvmm__types_8h_af7e9bd0adfb7d10e7a7a0ee60a5f962c}{vmid\-\_\-t} vmid)
\item 
\hyperlink{hvmm__types_8h_a39d593b2c97852f566d7472b76ab7ba2}{hvmm\-\_\-status\-\_\-t} \hyperlink{virq_8c_a47f4ee9004f1b4f6a87cf6e1f4c51557}{virq\-\_\-init} (void)
\end{DoxyCompactItemize}
\subsection*{\-Variables}
\begin{DoxyCompactItemize}
\item 
static struct \hyperlink{structvirq__entry}{virq\-\_\-entry} \hyperlink{virq_8c_a9abd415387f2937fc685ae81d46bd0d8}{\-\_\-guest\-\_\-virqs} \mbox{[}\hyperlink{hyp__config_8h_a7fcfcbc766cea81a21e2d8aba3b54843}{\-N\-U\-M\-\_\-\-G\-U\-E\-S\-T\-S\-\_\-\-S\-T\-A\-T\-I\-C}\mbox{]}\mbox{[}\hyperlink{virq_8c_a1d67362b0e88bdcf1949d27e6308aea6}{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}+1\mbox{]}
\end{DoxyCompactItemize}


\subsection{\-Define \-Documentation}
\hypertarget{virq_8c_ad221f8c247cfc9c0662d3df9582084b1}{\index{virq.\-c@{virq.\-c}!\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q@{\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}}
\index{\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q@{\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}!virq.c@{virq.\-c}}
\subsubsection[{\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}(
\begin{DoxyParamCaption}
\item[{}]{pirq}
\end{DoxyParamCaption}
)~(pirq $>$= {\bf \-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q} \&\& pirq $<$ {\bf \-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S})}}\label{virq_8c_ad221f8c247cfc9c0662d3df9582084b1}


\-Definition at line 13 of file virq.\-c.

\hypertarget{virq_8c_a1d67362b0e88bdcf1949d27e6308aea6}{\index{virq.\-c@{virq.\-c}!\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S@{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}}
\index{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S@{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}!virq.c@{virq.\-c}}
\subsubsection[{\-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}~128}}\label{virq_8c_a1d67362b0e88bdcf1949d27e6308aea6}


\-Definition at line 15 of file virq.\-c.

\hypertarget{virq_8c_ae7aecd279ea8dfcea62c7472d3f29fde}{\index{virq.\-c@{virq.\-c}!\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q@{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}}
\index{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q@{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}!virq.c@{virq.\-c}}
\subsubsection[{\-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-V\-I\-R\-Q\-\_\-\-M\-I\-N\-\_\-\-V\-A\-L\-I\-D\-\_\-\-P\-I\-R\-Q}~16}}\label{virq_8c_ae7aecd279ea8dfcea62c7472d3f29fde}


\-Definition at line 10 of file virq.\-c.

\hypertarget{virq_8c_afbf0d191562f9b6d4977a7e332e4decd}{\index{virq.\-c@{virq.\-c}!\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S@{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S}}
\index{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S@{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S}!virq.c@{virq.\-c}}
\subsubsection[{\-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-V\-I\-R\-Q\-\_\-\-N\-U\-M\-\_\-\-M\-A\-X\-\_\-\-P\-I\-R\-Q\-S}~1024}}\label{virq_8c_afbf0d191562f9b6d4977a7e332e4decd}


\-Definition at line 11 of file virq.\-c.



\subsection{\-Function \-Documentation}
\hypertarget{virq_8c_ab76bcaec8e983ed0c8ac21a738b7eb31}{\index{virq.\-c@{virq.\-c}!virq\-\_\-flush@{virq\-\_\-flush}}
\index{virq\-\_\-flush@{virq\-\_\-flush}!virq.c@{virq.\-c}}
\subsubsection[{virq\-\_\-flush}]{\setlength{\rightskip}{0pt plus 5cm}static void {\bf virq\-\_\-flush} (
\begin{DoxyParamCaption}
\item[{{\bf vmid\-\_\-t}}]{vmid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{virq_8c_ab76bcaec8e983ed0c8ac21a738b7eb31}


\-Definition at line 51 of file virq.\-c.


\begin{DoxyCode}
{
    /* Actual injection of queued VIRQs takes place here */

    int i;
    int count = 0;
    struct virq_entry *entries = &_guest_virqs[vmid][0];

    for( i = 0; i < VIRQ_MAX_ENTRIES; i++) {
        if ( entries[i].valid ) {
            uint32_t slot;
            if ( entries[i].hw ) {
                slot = vgic_inject_virq_hw(entries[i].virq, VIRQ_STATE_PENDING,
       GIC_INT_PRIORITY_DEFAULT, entries[i].pirq);
                if ( slot != VGIC_SLOT_NOTFOUND ) {
                    slotpirq_set( vmid, slot, entries[i].pirq );
                }
            } else {
                slot = vgic_inject_virq_sw(entries[i].virq, VIRQ_STATE_PENDING,
       GIC_INT_PRIORITY_DEFAULT, smp_processor_id(), 1);
            }

            if (slot == VGIC_SLOT_NOTFOUND ) {
                break;
            }

            slotvirq_set( vmid, slot, entries[i].virq );    

            /* Forget */
            entries[i].valid = 0;

            count++;
        }
    }
    if ( count > 0 ) {
        printh( "virq: injected %d virqs to vmid %d \n", count, vmid );
    }
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virq_8c_ab76bcaec8e983ed0c8ac21a738b7eb31_cgraph}
\end{center}
\end{figure}


\hypertarget{virq_8c_a47f4ee9004f1b4f6a87cf6e1f4c51557}{\index{virq.\-c@{virq.\-c}!virq\-\_\-init@{virq\-\_\-init}}
\index{virq\-\_\-init@{virq\-\_\-init}!virq.c@{virq.\-c}}
\subsubsection[{virq\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf virq\-\_\-init} (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{virq_8c_a47f4ee9004f1b4f6a87cf6e1f4c51557}


\-Definition at line 88 of file virq.\-c.


\begin{DoxyCode}
{
    int i, j;

    for( i = 0; i < NUM_GUESTS_STATIC; i++) {
        for( j = 0; j < (VIRQ_MAX_ENTRIES + 1); j++ ) {
            _guest_virqs[i][j].valid = 0;
        }
    }

    vgic_setcallback_virq_flush(&virq_flush);
    return HVMM_STATUS_SUCCESS;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{virq_8c_a47f4ee9004f1b4f6a87cf6e1f4c51557_cgraph}
\end{center}
\end{figure}


\hypertarget{virq_8c_a6bd895c43353871b1a0da7c40301215d}{\index{virq.\-c@{virq.\-c}!virq\-\_\-inject@{virq\-\_\-inject}}
\index{virq\-\_\-inject@{virq\-\_\-inject}!virq.c@{virq.\-c}}
\subsubsection[{virq\-\_\-inject}]{\setlength{\rightskip}{0pt plus 5cm}{\bf hvmm\-\_\-status\-\_\-t} {\bf virq\-\_\-inject} (
\begin{DoxyParamCaption}
\item[{{\bf vmid\-\_\-t}}]{vmid, }
\item[{{\bf uint32\-\_\-t}}]{virq, }
\item[{{\bf uint32\-\_\-t}}]{pirq, }
\item[{{\bf uint8\-\_\-t}}]{hw}
\end{DoxyParamCaption}
)}}\label{virq_8c_a6bd895c43353871b1a0da7c40301215d}


\-Definition at line 26 of file virq.\-c.


\begin{DoxyCode}
{
    hvmm_status_t result = HVMM_STATUS_BUSY;
    int i;
    struct virq_entry *q = &_guest_virqs[vmid][0];
    int slot = slotvirq_getslot(vmid, virq);
    if ( slot == SLOT_INVALID ) {
        /* Inject only the same virq is not present in a slot */
        for( i = 0; i < VIRQ_MAX_ENTRIES; i++ ) {
            if ( q[i].valid == 0 ) {
                q[i].pirq = pirq;
                q[i].virq = virq;   
                q[i].hw = hw;
                q[i].valid = 1;
                result = HVMM_STATUS_SUCCESS;
                break;
            }
        }
    printh( "virq: queueing virq %d pirq %d to vmid %d %s\n", virq, pirq, vmid,
       result == HVMM_STATUS_SUCCESS ? "done" : "failed");
    } else {
     printh( "virq: rejected queueing duplicated virq %d pirq %d to vmid %d %s
      \n", virq, pirq, vmid);    
    }
    return result;
}
\end{DoxyCode}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=262pt]{virq_8c_a6bd895c43353871b1a0da7c40301215d_cgraph}
\end{center}
\end{figure}




\subsection{\-Variable \-Documentation}
\hypertarget{virq_8c_a9abd415387f2937fc685ae81d46bd0d8}{\index{virq.\-c@{virq.\-c}!\-\_\-guest\-\_\-virqs@{\-\_\-guest\-\_\-virqs}}
\index{\-\_\-guest\-\_\-virqs@{\-\_\-guest\-\_\-virqs}!virq.c@{virq.\-c}}
\subsubsection[{\-\_\-guest\-\_\-virqs}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf virq\-\_\-entry} {\bf \-\_\-guest\-\_\-virqs}\mbox{[}{\bf \-N\-U\-M\-\_\-\-G\-U\-E\-S\-T\-S\-\_\-\-S\-T\-A\-T\-I\-C}\mbox{]}\mbox{[}{\bf \-V\-I\-R\-Q\-\_\-\-M\-A\-X\-\_\-\-E\-N\-T\-R\-I\-E\-S}+1\mbox{]}\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{virq_8c_a9abd415387f2937fc685ae81d46bd0d8}


\-Definition at line 24 of file virq.\-c.

